-
  I create a new zip code
-
  !record {model: l10n_br.zip, id: company_zip_test }:
    zip: 03120010
    l10n_br_city_id: l10n_br_base.city_3550308
    state_id: base.state_br_sp
    country_id: base.br
    street: Curupacê
    street_type: Rua
    district: Mooca
-
  I set the created zip code to company and check if it returns correctly
-
  !python {model: res.company, id: base.main_company }: |
    self.zip = '03120010'
    assert self.zip_search(), 'Zip search does not return true'
    assert self.district == 'Mooca', 'District value is wrong'
    assert self.street == 'Rua Curupacê', 'Street value is wrong'
    assert self.l10n_br_city_id.id == ref('l10n_br_base.city_3550308')
-
  I set the values to search the zip code now
-
  !python {model: res.company, id: base.main_company }: |
    self.zip = ''
    self.state_id = ref('base.state_br_sp')
    self.l10n_br_city_id = ref('l10n_br_base.city_3550308')
    self.street = 'Curupacê'
    assert self.zip_search(), 'Zip search does not return true'
    assert self.zip == '03120-010', 'Zip code is wrong'
-
 I check if it raises a warning when there is no zip code
-
  !python {model: res.company, id: base.main_company }: |
    self.zip = '03120011'
    try:
        self.zip_search()
        assert 1 == 2, 'Zip search does not raise warning when no zip code found'
    except:
        pass
-
  I create a new zip to test multiple results
-
  !record {model: l10n_br.zip, id: company_zip_test2 }:
    zip: 01448090
    l10n_br_city_id: l10n_br_base.city_3550308
    state_id: base.state_br_sp
    country_id: base.br
    street: Peruíbe
    street_type: Rua
    district: Itaim Bibi
-
  I set the values to search the zip and test if it returns two zip
-
  !python {model: res.company, id: base.main_company }: |
    self.zip = ''
    self.state_id = ref('base.state_br_sp')
    self.l10n_br_city_id = ref('l10n_br_base.city_3550308')
    self.street = 'Curupacê'
    self.district = ''
    result = self.zip_search()
    assert result['type'] == 'ir.actions.act_window', 'It should return a action when there are more than one result'
    assert result['res_model'] == 'l10n_br.zip.search', 'It should return the model zip.search'
    assert result['context']['street'] == 'Peruíbe', 'It should return the correct street'
    assert result['context']['state_id'] == ref('base.state_br_sp'), 'It should return the correct state'
